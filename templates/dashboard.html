{% extends "base.html" %}
{% block body %}
 <h1>GenEcomm</h1>
<div class="dashboard-wrapper">
  <div class="sidebar" id="sidebar">
        <button class="close-sidebar-btn" onclick="toggleSidebar()">‚úñ</button>
    <div class="profile">
  <img src="{{ url_for('auth.user_image') }}" alt="Profile">
  <div class="profile-info">
    <h3>{{session['username']}}</h3>
    <a href = "{{url_for('auth.account_settings')}}">account settings</a>
  </div>
</div>

    <a href="#">üè† Dashboard</a>
    <a href="#">üîç Search Product</a>
    <a href="#">üìà Forecasts</a>
    <a href="#">‚≠ê Recommendations</a>
    <a href="{{ url_for('auth.logout') }}" class="logout-btn">Log out</a>
  </div>

  <div class="main-content">
    <button class="open-sidebar-btn" onclick="toggleSidebar()">‚ò∞</button>
    <h2>Welcome, {{session['username']}}</h2>
    {% if prediction is defined and prediction is not none and prediction|length > 0 and product_name %}
      <p>Your last viewed product, {{ product_name }} - predicted price ${{ prediction[0] }} next week</p>
    {% else %}
      <p>No prediction data available yet.</p>
    {% endif %}


    <div class="search-bar">
      <h3>Predict Future Price</h3>
      <form id="predict-form" method="post" action="{{ url_for('predict.predict') }}">
        <label for="product_name">Enter product name:</label>
        <input type="text" name="product_name" id="product_name" placeholder="e.g. iPhone 14" required style="width:220px;">
        <input type="submit" value="Predict" style="margin-left:10px;">
      </form>
      {% if prediction is defined %}
        <div class="prediction-result">
          <strong>Predicted Prices for {{product_name}}:</strong>
          {% if prediction is not none and prediction|length > 1 %}
            <ul style="margin:0; padding-left:1.2em;">
              {% for p in prediction %}
                {% if loop.index == 1 %}
                  <li>Next week: ${{ p }}</li>
                {% else %}
                  <li>{{ loop.index }} weeks: ${{ p }}</li>
                {% endif %}
              {% endfor %}
            </ul>
          {% else %}
            {{ prediction }}
          {% endif %}
        </div>
      {% elif error is defined %}
        <div class="prediction-error" style="color:#c0392b;">{{ error }}</div>
      {% endif %}
    </div>

    <div class="results">
      <h3>Related Products</h3>
      <ul>
        {% if product_name and related_products is defined and related_products|length > 0 %}
          {% for prod in related_products[:3] %}
            <li>{{ prod.description }} - ${{ prod.prices[-1]|round(2) }} <span>see forecast</span></li>
          {% endfor %}
        {% else %}
          <li>No related products found.</li>
        {% endif %}
      </ul>
    </div>

   <div class="recent-activity">
      <h3>Recent Activity</h3>
      <div class="activity-cards">
        <div class="card">
          <div class="image"></div>
          <p></p>
          <p></p>
          <p></p>
        </div>
        <div class="card">
          <div class="image"></div>
          <p></p>
          <p></p>
          <p></p>
        </div>
        <div class="card">
          <div class="image"></div>
          <p></p>
          <p></p>
          <p></p>
        </div>
      </div>
    </div>
</div>
<script>
function toggleSidebar() {
  var sidebar = document.getElementById('sidebar');
  sidebar.classList.toggle('sidebar-hidden');
  // Show open button only when sidebar is hidden
  document.getElementById('openSidebarBtn').style.display = sidebar.classList.contains('sidebar-hidden') ? 'block' : 'none';
}
window.onload = function() {
  // Hide open button initially
  document.getElementById('openSidebarBtn').style.display = 'none';
}
</script>
{% endblock %}